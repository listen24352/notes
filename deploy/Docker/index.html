<!DOCTYPE html>
<html lang="zh_CN" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Docker - Listen</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../css/brands.min.css" rel="stylesheet">
        <link href="../../css/solid.min.css" rel="stylesheet">
        <link href="../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../../code.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Listen</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">grammar</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../python/grammar/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="dropdown-item">数据结构</a>
</li>
            
<li>
    <a href="../../python/grammar/%E5%87%BD%E6%95%B0/" class="dropdown-item">函数</a>
</li>
            
<li>
    <a href="../../python/grammar/%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/" class="dropdown-item">内置函数</a>
</li>
            
<li>
    <a href="../../python/grammar/%E7%B1%BB/" class="dropdown-item">类</a>
</li>
            
<li>
    <a href="../../python/grammar/%E8%A3%85%E9%A5%B0%E5%99%A8/" class="dropdown-item">装饰器</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Library</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../python/library/os/" class="dropdown-item">os</a>
</li>
            
<li>
    <a href="../../python/library/shutil/" class="dropdown-item">shutil</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Automated testing</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../testing/Selenium/" class="dropdown-item">Selenium</a>
</li>
                                    
<li>
    <a href="../../testing/PyAutoGUI%20and%20pyperclip/" class="dropdown-item">PyAutoGUI</a>
</li>
                                    
<li>
    <a href="../../testing/pytest/" class="dropdown-item">Pytest</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Deploy</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../Linux/" class="dropdown-item">Linux</a>
</li>
                                    
<li>
    <a href="../nginx/" class="dropdown-item">Nginx</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Docker</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">tool</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../tool/Git/" class="dropdown-item">Git</a>
</li>
                                    
<li>
    <a href="../../tool/Openpyxl/" class="dropdown-item">Openpyxl</a>
</li>
                                    
<li>
    <a href="../../tool/Pandas/" class="dropdown-item">Pandas</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../nginx/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../tool/Git/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                              <button id="theme-menu" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme" class="nav-link dropdown-toggle">
                                <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                <span class="d-lg-none ms-2">Toggle theme</span>
                              </button>
                              <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="true">
                                    <i class="fa-solid fa-sun fa-fw"></i>
                                    <span class="ms-2">Light</span>
                                    <i class="fa-solid fa-check ms-auto"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                                    <i class="fa-solid fa-moon fa-fw"></i>
                                    <span class="ms-2">Dark</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                                <li>
                                  <button class="dropdown-item d-flex align-items-center" data-bs-theme-value="auto" aria-pressed="false">
                                    <i class="fa-solid fa-circle-half-stroke fa-fw"></i>
                                    <span class="ms-2">Auto</span>
                                    <i class="fa-solid fa-check ms-auto d-none"></i>
                                  </button>
                                </li>
                              </ul>
                            </li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="../../js/darkmode.js"></script>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#docker" class="nav-link">docker</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<div class="toc">
<ul>
<li><a href="#docker">docker</a><ul>
<li><a href="#docker_1">为什么使用docker</a></li>
<li><a href="#image">镜像（image）</a></li>
<li><a href="#container">容器（container）</a></li>
<li><a href="#repository">仓库（repository）</a></li>
<li><a href="#docker_2">安装docker</a></li>
<li><a href="#docker_3">操作docker相关命令</a></li>
<li><a href="#docker-file">Docker File 指令详解</a><ul>
<li><a href="#from">FROM 指定基础镜像</a></li>
<li><a href="#run">RUN 执行命令</a></li>
<li><a href="#_1">构建镜像</a></li>
<li><a href="#copy">COPY 复制文件</a></li>
<li><a href="#add">ADD 更高级的复制文件</a></li>
<li><a href="#cmd">CMD 容器启动命令</a></li>
<li><a href="#entrypoint">ENTRYPOINT 入口点</a></li>
<li><a href="#env">ENV 设置环境变量</a></li>
<li><a href="#arg">ARG 构建参数</a></li>
<li><a href="#volume">VOLUME 定义匿名卷</a></li>
<li><a href="#expose">EXPOSE 暴露端口</a></li>
<li><a href="#workdir">WORKDIR 指定工作目录</a></li>
<li><a href="#user">USER 指定当前用户</a></li>
<li><a href="#healthcheck">HEALTHCHECK 健康检查</a></li>
<li><a href="#onbuild">ONBUILD 为他人做嫁衣裳</a></li>
</ul>
</li>
<li><a href="#_2">镜像操作</a></li>
<li><a href="#_3">容器操作</a></li>
<li><a href="#docker_4">宿主机与docker容器的文件传递</a><ul>
<li><a href="#_4">从宿主机到容器</a></li>
<li><a href="#_5">从容器到宿主机</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="docker">docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h1>
<h3 id="docker_1">为什么使用docker<a class="headerlink" href="#docker_1" title="Permanent link">&para;</a></h3>
<ul>
<li>更高效的利用系统资源</li>
<li>更快速的启动时间</li>
<li>一致的运行环境</li>
<li>持续交付和部署</li>
<li>更轻松的迁移</li>
<li>更轻松的维护和扩展</li>
</ul>
<h3 id="image">镜像（image）<a class="headerlink" href="#image" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code>分层存储</code></pre>
<h3 id="container">容器（container）<a class="headerlink" href="#container" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-shell"># 镜像和容器类似于面向对象的类和实例</code></pre>
<h3 id="repository">仓库（repository）<a class="headerlink" href="#repository" title="Permanent link">&para;</a></h3>
<h3 id="docker_2">安装docker<a class="headerlink" href="#docker_2" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-shell"># ubuntu:20.04
sudo apt-get update

sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release

curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg

echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null

sudo apt-get update

sudo apt-get install docker-ce docker-ce-cli containerd.io

# 卸载
sudo apt-get purge docker-ce docker-ce-cli containerd.io
sudo rm -rf /var/lib/docker
sudo rm -rf /var/lib/containerd</code></pre>
<pre class="highlight"><code class="language-shell"># 镜像加速
# https://cr.console.aliyun.com/cn-beijing/instances/mirrors


# /etc/docker/daemon.json 文件不存在创建
{
  "registry-mirrors": [
    "https://registry.docker-cn.com"
  ]
}

sudo systemctl daemon-reload
sudo systemctl restart docker</code></pre>
<h3 id="docker_3">操作docker相关命令<a class="headerlink" href="#docker_3" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-dockerfile"># https://docs.docker.com/reference/
# 查看docker版本

docker -v
# 查看docker 命令
docker --help
# 查看docker 服务端与客户端版本详情
docker version
# 启动docker
systemctl start docker
# 关闭docker
systemctl stop docker
# 重启docker
systemctl stop docker
# 查看docker运行状态
systemctl status docker
# 关闭防火墙
systemctl stop firewalld

# 开启自动启动容器
docker update --restart=always 容器name</code></pre>
<h3 id="docker-file">Docker File 指令详解<a class="headerlink" href="#docker-file" title="Permanent link">&para;</a></h3>
<h6 id="from">FROM 指定基础镜像<a class="headerlink" href="#from" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">FROM python
# 必备指令 必须是第一条指令
FROM scratch  # 指定空白镜像</code></pre>
<h6 id="run">RUN 执行命令<a class="headerlink" href="#run" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">RUN 
# shell 格式：RUN &lt;命令&gt; 
# exec 格式：RUN["可执行文件","参数1","参数2"]

# 错误写法
FROM debian:jessie

RUN apt-get update
RUN apt-get install -y gcc libc6-dev make
RUN wget -O redis.tar.gz "http://download.redis.io/releases/redis-3.2.5.tar.gz"
RUN mkdir -p /usr/src/redis
RUN tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1
RUN make -C /usr/src/redis
RUN make -C /usr/src/redis install

# 正确写法
FROM debian:jessie


RUN buildDeps='gcc libc6-dev make' \
    &amp;&amp; apt-get update \
    &amp;&amp; apt-get install -y $buildDeps \
    &amp;&amp; wget -O redis.tar.gz "http://download.redis.io/releases/redis-3.2.5.tar.gz" \
    &amp;&amp; mkdir -p /usr/src/redis \
    &amp;&amp; tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \
    &amp;&amp; make -C /usr/src/redis \
    &amp;&amp; make -C /usr/src/redis install \
    &amp;&amp; rm -rf /var/lib/apt/lists/* \
    &amp;&amp; rm redis.tar.gz \
    &amp;&amp; rm -r /usr/src/redis \
    &amp;&amp; apt-get purge -y --auto-remove $buildDeps</code></pre>
<h6 id="_1">构建镜像<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">docker build -t nainx:v3 .
docker build [选项] &lt;上下文路径/URL/-&gt;
</code></pre>
<h6 id="copy">COPY 复制文件<a class="headerlink" href="#copy" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">COPY &lt;原路径&gt;...&lt;目标路径&gt;
COPY ["&lt;原路径&gt;",..."&lt;目标路径&gt;"]

COPY package.json /usr/src/app/
# 通配符要满足Go的filepath.Match
COPY hom* /mydir/
COPY hom?.txt /mydir/</code></pre>
<h6 id="add">ADD 更高级的复制文件<a class="headerlink" href="#add" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">ADD # 不实用不推荐使用 仅在需要自动解压缩的场合使用</code></pre>
<h6 id="cmd">CMD 容器启动命令<a class="headerlink" href="#cmd" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">shell格式： CMD &lt;命令&gt;
exec格式: CMD ["可执行文件","参数1","参数2"] # 推荐使用 必须使用",不能用单'

CMD ECHO $HMOE

CMD ["SH", "-C", "ECHO $HMOE"]

CMD ["nginx", "-g", "daemon off;"]

</code></pre>
<h6 id="entrypoint">ENTRYPOINT 入口点<a class="headerlink" href="#entrypoint" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code>&lt;ENTRYPOINT&gt; "&lt;CMD&gt;"
</code></pre>
<h6 id="env">ENV 设置环境变量<a class="headerlink" href="#env" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code class="language-dockerfile">ENV &lt;key&gt; &lt;value&gt;
ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...

ENV VERSION=1.0 DEBUG=on \
    NAME="Happy Feet"</code></pre>
<h6 id="arg">ARG 构建参数<a class="headerlink" href="#arg" title="Permanent link">&para;</a></h6>
<h6 id="volume">VOLUME 定义匿名卷<a class="headerlink" href="#volume" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code>VOLUME /data

docker run -d -v mydata:/data xxxx</code></pre>
<h6 id="expose">EXPOSE 暴露端口<a class="headerlink" href="#expose" title="Permanent link">&para;</a></h6>
<pre class="highlight"><code>EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]
</code></pre>
<h6 id="workdir">WORKDIR 指定工作目录<a class="headerlink" href="#workdir" title="Permanent link">&para;</a></h6>
<h6 id="user">USER 指定当前用户<a class="headerlink" href="#user" title="Permanent link">&para;</a></h6>
<h6 id="healthcheck">HEALTHCHECK 健康检查<a class="headerlink" href="#healthcheck" title="Permanent link">&para;</a></h6>
<h6 id="onbuild">ONBUILD 为他人做嫁衣裳<a class="headerlink" href="#onbuild" title="Permanent link">&para;</a></h6>
<h3 id="_2">镜像操作<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-dockerfile"># 查看本地镜像
docker images
# 搜索镜像 先本地 后默认地址
docker search tomcat
# 找到所有的镜像拉取 
docker pull tomcat # 最新版本
docker pull tomcat:7 # 最新版本
# 有了本地镜像可以创建容器  
docker create --name=mytomcat tomcat
# 查看容器
docker ps  # 查看在运行的容器
docker ps -a  # 查看所有的容器
# 运行容器
docker start myTomcat # start 后面可以跟 容器id(前2-3位) 或者name
# 停止容器
docker stop  myTomcat # stop 后面可以跟 容器id(前2-3位) 或者name
# 删除没有运行的容器
docker rm 容器id或者名字
# 删除在运行的容器
docker rm -f 容器id或者名字
# 删除所有容器
docker stop $(docker ps -a -q)  先停止所有的容器
# 删除
docker rm $(docker ps -a -q)</code></pre>
<h3 id="_3">容器操作<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<pre class="highlight"><code class="language-dockerfile"># 查看docker run 命令  创建并且启动容器 tomcat端口 8080
docker run --help
    -i  # 运行容器
    -t  # 容器启动后,进入命令行
    -v  # 目录映射  挂载
    -d  # 守护进程  后台运行
    -p  # 端口映射 
# 创建容器,并且进入命令行  进入容器
docker run -it --name=mytomcat tomcat/bin/bash
# 退出
exit
#创建运行一个守护的容器
docker run -id --name=mytomcat2 tomcat
# 进入容器
docker exec -it mytomcat2 /bin/bash</code></pre>
<h3 id="docker_4">宿主机与docker容器的文件传递<a class="headerlink" href="#docker_4" title="Permanent link">&para;</a></h3>
<h4 id="_4">从宿主机到容器<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-sh"># 创建 一个文件
touch 1.py
# 把文件复制到容器里去
docker cp 1.py mytomcat2:/
# 进入根目录
cd /
# 查看
ls</code></pre>
<h4 id="_5">从容器到宿主机<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<pre class="highlight"><code class="language-sh"># 创建文件
touch adb.jpg
# 退出容器
exit
# 复制到宿主机
docker cp mytomcat2:/abc.jpg /root</code></pre>
<pre class="highlight"><code>docker tag local-image:tagname new-repo:tagname
docker push new-repo:tagname</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
